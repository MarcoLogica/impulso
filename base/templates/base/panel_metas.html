<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Metas semanales - IMPULSO</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/estilos.css' %}">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #f6f9fc, #eaf4ff);
      padding: 40px;
      color: #34495e;
    }

    .contenedor {
      max-width: 1000px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
       font-size: 30px;
    }

    h2 {
      margin-bottom: 10px;
      font-size: 40px;
    }

    .motivacion {
      font-style: italic;
      color: #7f8c8d;
      margin-bottom: 30px;

    }

    .bloque-iniciativa {
      background: #ffffff;
      border-left: 6px solid #3498db;
      padding: 18px;
      border-radius: 10px;
      margin-bottom: 30px;

    }

    .barra-progreso {
      background-color: #dfe6e9;
      border-radius: 6px;
      height: 16px;
      margin: 10px 0;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
    }

    .barra-avance {
      background: linear-gradient(to right, #2ecc71, #27ae60);
      height: 100%;
      transition: width 0.3s ease;
    }

    .fase-item {
      background: #f8fbff;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #dceefb;
      margin-bottom: 15px;
    }

    .fase-item.completed {
      background: #eaf9ea;
      border-left: 5px solid #2ecc71;
    }

    .fase-item input[type="text"] {
      width: 90%;
      margin-top: 6px;
       font-size: 30px;
    }

    .fase-item button {
      margin-top: 6px;
      background-color: #3498db;
      color: white;
      border: none;
      padding: 6px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
       font-size: 25px;
    }

    .fase-item label {
      display: block;
      margin-top: 6px;
      font-size: 0.9em;
    }

    small {
      font-size: 0.9em;
      color: #7f8c8d;
    }
  </style>
</head>
<body>

  <div class="contenedor">
    <h2>üéØ Metas activas esta semana ({{ inicio|date:"d M" }} - {{ fin|date:"d M" }})</h2>
    <p class="motivacion">‚ÄúCada paso esta semana cuenta. Impulsa tu avance y hazlo visible.‚Äù üí™</p>

    <div style="text-align: center; margin-top: 40px;">
      <a href="{% url 'feed_comunitario' %}" style="
        background-color: #2980b9;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: bold;
        font-size: 1.1em;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        transition: background 0.3s ease;
      " onmouseover="this.style.backgroundColor='#3498db'" onmouseout="this.style.backgroundColor='#2980b9'">
        ‚¨ÖÔ∏è Volver al feed comunitario
      </a>
    </div>

    {% if iniciativas_data %}
      {% for item in iniciativas_data %}
        <div class="bloque-iniciativa">
          <h3>{{ item.iniciativa.icono }} {{ item.iniciativa.nombre }}</h3>

          <div class="barra-progreso">
            <div class="barra-avance" style="width:{{ item.porcentaje }}%;"></div>
          </div>
          <p>{{ item.completadas }} de {{ item.total }} fases completadas</p>

          <ul style="list-style:none; padding:0;">
            {% for fase in item.fases %}
              <li class="fase-item {% if fase.completado %}completed{% endif %}">

                {% if fase.completado %}
                  ‚úîÔ∏è <strong>{{ fase.nombre }}</strong><br>
                  <small>Reflexi√≥n: {{ fase.reflexion|default:"Sin reflexi√≥n" }}</small>

                {% else %}
                  ‚è≥ <strong>{{ fase.nombre }}</strong><br>
                  <form method="post" action="{% url 'completar_fase' fase.id %}">
                    {% csrf_token %}
                    <button type="submit">‚úîÔ∏è Marcar como completada</button>
                    <input type="text" name="reflexion" placeholder="¬øC√≥mo te sentiste?">
                    <label>
                      <input type="checkbox" name="publicar_en_feed" checked> Compartir en el feed
                    </label>


                  </form>
                {% endif %}


                <!-- ‚≠ê DETALLE DE TAREAS DE LA SEMANA -->
                {% if fase.tareas %}
                  <ul style="margin-top:12px; padding-left:18px; list-style:none;">
                    {% for tarea in fase.tareas %}
                      <li style="
                        background:#f4f9ff;
                        padding:10px 12px;
                        border-radius:8px;
                        margin-bottom:8px;
                        border-left:5px solid #85c1e9;
                      ">
                        <strong>{{ tarea.nombre }}</strong><br>
                        <small>
                          üìÖ {{ tarea.fecha_inicio|date:"d M" }}
                          ‚Ä¢ ‚è≥ {{ tarea.duracion_dias }} d√≠as
                          ‚Ä¢ Estado: <em>{{ tarea.get_estado_display }}</em>
                        </small>
                      </li>
                    <a href="{% url 'vista_plan' item.iniciativa.id %}#fase-{{ fase.id }}"
   style="
     display:inline-block;
     background:#8e44ad;
     color:white;
     padding:6px 14px;
     border-radius:6px;
     font-weight:bold;
     text-decoration:none;
     margin-top:8px;
     margin-bottom:10px;
     font-size:0.9em;
     box-shadow:0 2px 6px rgba(0,0,0,0.1);
   "
   onmouseover="this.style.backgroundColor='#9b59b6'"
   onmouseout="this.style.backgroundColor='#8e44ad'">
   üöÄ Avanzar con esta Fase
</a>

                    {% endfor %}
                  </ul>
                {% else %}
                  <p style="font-size:0.9em; color:#7f8c8d; margin-top:10px;">
                    No hay tareas activas esta semana para esta fase.
                  </p>
                {% endif %}

              </li>
            {% endfor %}
          </ul>


        </div>


      {% endfor %}
    {% else %}
      <p>No hay metas activas para esta semana. Aseg√∫rate de que tus fases tengan tareas con fechas esta semana o asigna una <strong>fecha objetivo</strong> manualmente üìÜ</p>
    {% endif %}

  </div>

</body>
</html>
